{"version":3,"sources":["Vim.js"],"names":["define","declare","kernel","cookie","JSON","baseUnload","lang","constructor","idStateName","this","addOnUnload","hitch","loadCredentials","idJson","idObject","_supportsLocalStorage","window","localStorage","getItem","length","parse","id","initialize","storeCredentials","credentials","idString","stringify","toJson","setItem","expires","e"],"mappings":";;;;;AAOAA,QACI,qBACA,cACA,cACA,YACA,oBACA,mBACD,SAAUC,EAASC,EAAQC,EAAQC,EAAMC,EAAYC,GAEpD,MAAOL,GAAQ,MACXM,YAAa,SAAUC,GACnBC,KAAKD,YAAcA,GAAe,6BAClCH,EAAWK,YAAYJ,EAAKK,MAAMF,KAAM,qBACxCA,KAAKG,mBAETA,gBAAiB,WACb,GAAIC,GAAQC,CAERD,GADAJ,KAAKM,wBACIC,OAAOC,aAAaC,QAAQT,KAAKD,aAEjCL,EAAOM,KAAKD,aAErBK,GAAqB,SAAXA,GAAqBA,EAAOM,OAAS,IAC/CL,EAAWV,EAAKgB,MAAMP,GACtBX,EAAOmB,GAAGC,WAAWR,KAI7BS,iBAAkB,WACd,GAAqC,IAAjCrB,EAAOmB,GAAGG,YAAYL,OAA1B,CAGA,GAAIM,GAAWrB,EAAKsB,UAAUxB,EAAOmB,GAAGM,SACpClB,MAAKM,wBACLC,OAAOC,aAAaW,QAAQnB,KAAKD,YAAaiB,GAE9CtB,EAAOM,KAAKD,YAAaiB,GACrBI,QAAS,MAKrBd,sBAAuB,WACnB,IACI,MAAO,gBAAkBC,SAAkC,OAAxBA,OAAOC,aAC5C,MAAOa,GACL,OAAO","file":"Vim.js","sourcesContent":["// Vim.js\r\n// Used to serialize/deserialize the identitymanager storing\r\n// credential objects (tokens) in either local storage or a cookie\r\n// usage:\r\n//  param 1: the name of the cookie/localstorage key\r\n//  new Vim(idStateName);\r\n\r\ndefine([\r\n    'dojo/_base/declare',\r\n    'esri/kernel',\r\n    'dojo/cookie',\r\n    'dojo/json',\r\n    'dojo/_base/unload',\r\n    'dojo/_base/lang'\r\n], function (declare, kernel, cookie, JSON, baseUnload, lang) {\r\n\r\n    return declare(null, {\r\n        constructor: function (idStateName) {\r\n            this.idStateName = idStateName || 'esri_jsapi_id_manager_data';\r\n            baseUnload.addOnUnload(lang.hitch(this, 'storeCredentials'));\r\n            this.loadCredentials();\r\n        },\r\n        loadCredentials: function () {\r\n            var idJson, idObject;\r\n            if (this._supportsLocalStorage()) {\r\n                idJson = window.localStorage.getItem(this.idStateName);\r\n            } else {\r\n                idJson = cookie(this.idStateName);\r\n            }\r\n            if (idJson && idJson !== 'null' && idJson.length > 4) {\r\n                idObject = JSON.parse(idJson);\r\n                kernel.id.initialize(idObject);\r\n            }\r\n        },\r\n\r\n        storeCredentials: function () {\r\n            if (kernel.id.credentials.length === 0) {\r\n                return;\r\n            }\r\n            var idString = JSON.stringify(kernel.id.toJson());\r\n            if (this._supportsLocalStorage()) {\r\n                window.localStorage.setItem(this.idStateName, idString);\r\n            } else {\r\n                cookie(this.idStateName, idString, {\r\n                    expires: 1\r\n                });\r\n            }\r\n        },\r\n\r\n        _supportsLocalStorage: function () {\r\n            try {\r\n                return 'localStorage' in window && window.localStorage !== null;\r\n            } catch (e) {\r\n                return false;\r\n            }\r\n        }\r\n    });\r\n});\r\n"]}