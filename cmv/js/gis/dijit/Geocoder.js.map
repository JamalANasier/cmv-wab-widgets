{"version":3,"sources":["Geocoder.js"],"names":["define","declare","_WidgetBase","_TemplatedMixin","a11yclick","lang","on","domClass","domStyle","Geocoder","MenuItem","SimpleMarkerSymbol","Graphic","InfoTemplate","GraphicsLayer","template","i18n","templateString","baseClass","expanded","collapsible","geocoderOptions","autoComplete","reverseGeocodeTemplate","join","postCreate","this","inherited","arguments","options","mixin","map","geocoder","geocoderNode","hitch","e","result","show","hide","own","searchNode","toggle","startup","mapRightClickMenu","addRightClickMenu","mapExtentSearch","arcgisGeocoder","searchExtent","extent","getExtent","evt","mapRightClickPoint","mapPoint","addChild","label","labels","getAddressHere","onClick","symbol","infoTemplate","graphics","id","addLayer","display","get","searchContainerNode","set","remove","containerNode","blur","add","focus","reverseGeocode","_task","locationToAddress","reverseGeocodeComplete","res","graphic","location","address","infoWindow","clearFeatures","setTitle","getTitle","setContent","getContent","setFeatures","screenPnt","toScreen","getInfoWindowAnchor","once","clear"],"mappings":"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","file":"Geocoder.js","sourcesContent":["// adapted from https://github.com/esri/arcgis-dijit-geocoder-button-js/\r\ndefine([\r\n    'dojo/_base/declare',\r\n    'dijit/_WidgetBase',\r\n    'dijit/_TemplatedMixin',\r\n    'dijit/a11yclick',\r\n    'dojo/_base/lang',\r\n    'dojo/on',\r\n    'dojo/dom-class',\r\n    'dojo/dom-style',\r\n    'esri/dijit/Geocoder',\r\n    'dijit/MenuItem',\r\n    'esri/symbols/SimpleMarkerSymbol',\r\n    'esri/graphic',\r\n    'esri/InfoTemplate',\r\n    'esri/layers/GraphicsLayer',\r\n    'dojo/text!./Geocoder/templates/Geocoder.html',\r\n    'dojo/i18n!./Geocoder/nls/resource',\r\n\r\n    'xstyle/css!./Geocoder/css/Geocoder.css'\r\n], function (declare, _WidgetBase, _TemplatedMixin, a11yclick, lang, on, domClass, domStyle, Geocoder, MenuItem, SimpleMarkerSymbol, Graphic, InfoTemplate, GraphicsLayer, template, i18n) {\r\n\r\n    return declare([_WidgetBase, _TemplatedMixin], {\r\n        templateString: template,\r\n        i18n: i18n,\r\n        baseClass: 'gis_GeocoderDijit',\r\n        expanded: true,\r\n        collapsible: false,\r\n        geocoderOptions: {\r\n            autoComplete: true\r\n        },\r\n        reverseGeocodeTemplate: [\r\n            '<table class=\"attrTable\">',\r\n            '<tr valign=\"top\">', '<td class=\"attrName\">${i18n.labels.address}</td>', '<td class=\"attrValue\">${Address}</td>', '</tr>',\r\n            '<tr valign=\"top\">', '<td class=\"attrName\">${i18n.labels.neighborhood}</td>', '<td class=\"attrValue\">${Neighborhood}</td>', '</tr>',\r\n            '<tr valign=\"top\">', '<td class=\"attrName\">${i18n.labels.city}</td>', '<td class=\"attrValue\">${City}</td>', '</tr>',\r\n            '<tr valign=\"top\">', '<td class=\"attrName\">${i18n.labels.subregion}</td>', '<td class=\"attrValue\">${SubRegion}</td>', '</tr>',\r\n            '<tr valign=\"top\">', '<td class=\"attrName\">${i18n.labels.region}</td>', '<td class=\"attrValue\">${Region}</td>', '</tr>',\r\n            '<tr valign=\"top\">', '<td class=\"attrName\">${i18n.labels.postalCode}</td>', '<td class=\"attrValue\">${Postal}&nbsp;${PostalExt}</td>', '</tr>',\r\n            '<tr valign=\"top\">', '<td class=\"attrName\">${i18n.labels.countryCode}</td>', '<td class=\"attrValue\">${CountryCode}</td>', '</tr>',\r\n            '<tr valign=\"top\">', '<td class=\"attrName\">${i18n.labels.locatorName}</td>', '<td class=\"attrValue\">${Loc_name}</td>', '</tr>',\r\n            '</table>'\r\n        ].join(''),\r\n\r\n        postCreate: function () {\r\n            this.inherited(arguments);\r\n            var options = lang.mixin({}, this.geocoderOptions, {\r\n                map: this.map\r\n            });\r\n            this.geocoder = new Geocoder(options, this.geocoderNode);\r\n\r\n            on(this.geocoder, 'select', lang.hitch(this, function (e) {\r\n                if (e.result) {\r\n                    this.show();\r\n                }\r\n            }));\r\n\r\n            if (this.collapsible) {\r\n                on(this.map, 'pan-start', lang.hitch(this, function () {\r\n                    this.hide();\r\n                }));\r\n                this.own(\r\n                    on(this.searchNode, a11yclick, lang.hitch(this, this.toggle))\r\n                );\r\n            } else {\r\n                this.expanded = true;\r\n            }\r\n            this.geocoder.startup();\r\n            if (this.expanded === true) {\r\n                this.show();\r\n            } else {\r\n                this.hide();\r\n            }\r\n            if (this.mapRightClickMenu) {\r\n                this.addRightClickMenu();\r\n            }\r\n            if (this.mapExtentSearch) {\r\n                this.geocoder.arcgisGeocoder.searchExtent = this.map.extent.getExtent();\r\n                this.map.on('extent-change', lang.hitch(this, function (evt) {\r\n                    this.geocoder.arcgisGeocoder.searchExtent = evt.extent;\r\n                }));\r\n            }\r\n        },\r\n        addRightClickMenu: function () {\r\n            this.map.on('MouseDown', lang.hitch(this, function (evt) {\r\n                this.mapRightClickPoint = evt.mapPoint;\r\n            }));\r\n            this.mapRightClickMenu.addChild(new MenuItem({\r\n                label: this.i18n.labels.getAddressHere,\r\n                onClick: lang.hitch(this, 'reverseGeocode')\r\n            }));\r\n            this.symbol = new SimpleMarkerSymbol();\r\n            this.infoTemplate = new InfoTemplate('Location', this.reverseGeocodeTemplate);\r\n            this.graphics = new GraphicsLayer({\r\n                id: 'reverseGeocode'\r\n            });\r\n            this.map.addLayer(this.graphics);\r\n        },\r\n        toggle: function () {\r\n            var display = domStyle.get(this.searchContainerNode, 'display');\r\n            if (display === 'block') {\r\n                this.hide();\r\n            } else {\r\n                this.show();\r\n            }\r\n        },\r\n        hide: function () {\r\n            domStyle.set(this.searchContainerNode, 'display', 'none');\r\n            domClass.remove(this.containerNode, 'open');\r\n            if (this.geocoder) {\r\n                this.geocoder.blur();\r\n            }\r\n        },\r\n        show: function () {\r\n            domStyle.set(this.searchContainerNode, 'display', 'block');\r\n            domClass.add(this.containerNode, 'open');\r\n            if (this.geocoder && !this.expanded) {\r\n                this.geocoder.focus();\r\n            }\r\n        },\r\n        reverseGeocode: function () {\r\n            this.geocoder._task.locationToAddress(this.mapRightClickPoint, 1000, lang.hitch(this, 'reverseGeocodeComplete'));\r\n        },\r\n        reverseGeocodeComplete: function (res) {\r\n            var graphic = new Graphic(res.location, this.symbol, res.address, this.infoTemplate);\r\n            this.graphics.add(graphic);\r\n\r\n            this.map.infoWindow.clearFeatures();\r\n            this.map.infoWindow.setTitle(graphic.getTitle());\r\n            this.map.infoWindow.setContent(graphic.getContent());\r\n            this.map.infoWindow.setFeatures([graphic]);\r\n\r\n            var screenPnt = this.map.toScreen(res.location);\r\n            this.map.infoWindow.show(screenPnt, this.map.getInfoWindowAnchor(screenPnt));\r\n            on.once(this.map.infoWindow, 'hide', lang.hitch(this, function () {\r\n                this.graphics.clear();\r\n            }));\r\n        }\r\n    });\r\n});"]}