/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.1
 *  Project: http://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/dom","dojo/_base/array","dojo/Deferred","esri/map","esri/IdentityManager"],function(a,b,c,d,e,f,g){return a(null,{initMapAsync:function(){var a=new f,c=[];return this._createMap(c).then(b.hitch(this,"_createMapResult",a,c)),a},_createMap:function(a){var b=new f,c=d.byId(this.config.layout.map)||"mapCenter";return this.config.webMapId?this._initWebMap?b=this._initWebMap(this.config.webMapId,c,this.config.webMapOptions):(a.push('The "_WebMapMixin" Controller Mixin is required to use a webmap'),b.resolve(a)):(this.map=new g(c,this.config.mapOptions),b.resolve(a)),b},_createMapResult:function(a,d){return this.map?(!this.config.webMapId&&this.config.mapOptions&&this.config.mapOptions.basemap?this.map.on("load",b.hitch(this,"_initLayers",d)):this._initLayers(d),this.config.operationalLayers&&this.config.operationalLayers.length>0?c.once(this.map,"layers-add-result",b.hitch(this,"_onLayersAddResult",a,d)):a.resolve(d)):a.resolve(d),a},_onLayersAddResult:function(a,b,c){e.forEach(c.layers,function(a){a.success!==!0&&b.push(a.error)},this),a.resolve(b)},_initLayers:function(a){this.layers=[];var c={csv:"esri/layers/CSVLayer",dataadapter:"esri/layers/DataAdapterFeatureLayer",dynamic:"esri/layers/ArcGISDynamicMapServiceLayer",feature:"esri/layers/FeatureLayer",georss:"esri/layers/GeoRSSLayer",image:"esri/layers/ArcGISImageServiceLayer",imagevector:"esri/layers/ArcGISImageServiceVectorLayer",kml:"esri/layers/KMLLayer",label:"esri/layers/LabelLayer",mapimage:"esri/layers/MapImageLayer",osm:"esri/layers/OpenStreetMapLayer",raster:"esri/layers/RasterLayer",stream:"esri/layers/StreamLayer",tiled:"esri/layers/ArcGISTiledMapServiceLayer",vectortile:"esri/layers/VectorTileLayer",webtiled:"esri/layers/WebTiledLayer",wfs:"esri/layers/WFSLayer",wms:"esri/layers/WMSLayer",wmts:"esri/layers/WMTSLayer"};c=b.mixin(c,this.config.layerTypes||{});var d=[];e.forEach(this.config.operationalLayers,function(b){var e=c[b.type];e?d.push(e):a.push('Layer type "'+b.type+'" is not supported: ')},this),require(d,b.hitch(this,function(){e.forEach(this.config.operationalLayers,function(a){var d=c[a.type];d&&require([d],b.hitch(this,"_initLayer",a))},this),this.map.addLayers(this.layers)}))},_initLayer:function(a,c){var d;d=a.url?new c(a.url,a.options):new c(a.options),this.layers.unshift(d);var e=!1;if("undefined"!=typeof a.legendLayerInfos&&"undefined"!=typeof a.legendLayerInfos.exclude&&(e=a.legendLayerInfos.exclude),!e){var f={};"undefined"!=typeof a.legendLayerInfos&&"undefined"!=typeof a.legendLayerInfos.layerInfo&&(f=a.legendLayerInfos.layerInfo);var g=b.mixin({layer:d,title:a.title||null},f);this.legendLayerInfos.unshift(g)}if(this.layerControlLayerInfos.unshift({layer:d,type:a.type,title:a.title,controlOptions:a.layerControlLayerInfos}),"feature"===a.type){var h={featureLayer:d};a.editorLayerInfos&&b.mixin(h,a.editorLayerInfos),h.exclude!==!0&&this.editorLayerInfos.push(h)}if("dynamic"===a.type||"feature"===a.type){var i={layer:d,title:a.title};a.identifyLayerInfos&&b.mixin(i,a.identifyLayerInfos),i.exclude!==!0&&this.identifyLayerInfos.push(i)}},initMapComplete:function(a){a&&a.length>0&&this.handleError({source:"Controller",error:a.join(", ")}),this.map&&(this.createWidgets(["map","layer"]),this.map.on("resize",function(a){var b=a.target.extent.getCenter();setTimeout(function(){a.target.centerAt(b)},100)}),this.createPanes(),this.createWidgets())},initMapError:function(a){this.handleError({source:"Controller",error:a})},resizeMap:function(){this.map&&this.map.resize()},getMapHeight:function(){return this.map?this.map.height:0}})});
//# sourceMappingURL=_MapMixin.js.map