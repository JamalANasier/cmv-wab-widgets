/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.1
 *  Project: http://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/_base/array","dojo/on","dojo/aspect","dojo/dom","dojo/query","dojo/dom-style","dojo/dom-class","dojo/dom-geometry","dojo/sniff","put-selector","dijit/layout/BorderContainer","dijit/layout/ContentPane","esri/dijit/PopupMobile","dojo/text!./templates/mapOverlay.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a(null,{panes:{left:{id:"sidebarLeft",placeAt:"outer",collapsible:!0,region:"left"},center:{id:"mapCenter",placeAt:"outer",region:"center",content:q}},collapseButtons:{},initLayout:function(){this.config.layout=this.config.layout||{},this.addTopics(),this.addTitles(),this.detectTouchDevices(),this.initPanes()},addTopics:function(){c.subscribe("viewer/togglePane",b.hitch(this,function(a){this.togglePane(a.pane,a.show,a.suppressEvent)})),c.subscribe("viewer/loadWidget",b.hitch(this,function(a){this.widgetLoader(a.options,a.position)})),this.config.isDebug&&c.subscribe("viewer/handleError",b.hitch(this,"handleError")),c.subscribe("mapClickMode/setCurrent",b.hitch(this,function(a){this.mapClickMode.current=a,c.publish("mapClickMode/currentSet",a)})),c.subscribe("mapClickMode/setDefault",b.hitch(this,function(){c.publish("mapClickMode/setCurrent",this.mapClickMode.defaultMode)}))},addTitles:function(){if(this.config.titles){var a=this.config.titles;if(a.header){var b=g.byId("headerTitleSpan");b&&(b.innerHTML=a.header)}if(a.subHeader){var c=g.byId("subHeaderTitleSpan");c&&(c.innerHTML=a.subHeader)}a.pageTitle&&(document.title=a.pageTitle)}},initPanes:function(){var a,c=this.config.panes||{};this.defaultPanes=b.clone(this.panes);for(a in this.panes)this.defaultPanes.hasOwnProperty(a)&&(c[a]=b.mixin(this.defaultPanes[a],c[a]));var d=g.byId(this.config.layout.container)||document.body;this.panes.outer=new n({id:"borderContainerOuter",design:"sidebar",gutters:!1}).placeAt(d);var e,f,h;for(a in c)c.hasOwnProperty(a)&&(e=b.clone(c[a]),f=this.panes[e.placeAt]||this.panes.outer,e.id=e.id||a,h=e.type,delete e.placeAt,delete e.type,delete e.collapsible,f&&("border"===h?this.panes[a]=new n(e).placeAt(f):e.region&&(this.panes[a]=new o(e).placeAt(f))));this.panes.outer.startup()},createPanes:function(){var a,c=this.config.panes||{};for(a in this.panes)this.defaultPanes.hasOwnProperty(a)&&(c[a]=b.mixin(this.defaultPanes[a],c[a]));this.collapseButtonsPane=this.config.collapseButtonsPane||"outer";for(a in c)if(c.hasOwnProperty(a)){if(c[a].collapsible&&(this.collapseButtons[a]=m(this.panes[this.collapseButtonsPane].domNode,"div.sidebarCollapseButton.sidebar"+a+"CollapseButton.sidebarCollapseButton"+("bottom"===a||"top"===a?"Vert":"Horz")+" div.dijitIcon.button.close").parentNode,e(this.collapseButtons[a],"click",b.hitch(this,"togglePane",a,null,!1)),this.positionSideBarToggle(a),"outer"===this.collapseButtonsPane)){var d=this.panes[a]._splitterWidget;d&&(f.after(d,"_startDrag",b.hitch(this,"_splitterStartDrag",a)),f.after(d,"_stopDrag",b.hitch(this,"_splitterStopDrag",a)))}void 0!==c[a].open&&this.togglePane(a,c[a].open,!0),"center"!==a&&this.panes[a]._splitterWidget&&(j.add(this.map.root.parentNode,"pane"+a),"right"===a&&this.panes.top&&j.add(this.panes.top.domNode,"pane"+a),"right"===a&&this.panes.bottom&&j.add(this.panes.bottom.domNode,"pane"+a),"left"===a&&this.panes.top&&j.add(this.panes.top.domNode,"pane"+a),"left"===a&&this.panes.bottom&&j.add(this.panes.bottom.domNode,"pane"+a))}this.resizeLayout()},togglePane:function(a,b,d){if(this.panes[a]){var e=this.panes[a].domNode;if(e){var f,g=i.get(e,"display");if("string"!=typeof b||"none"!==b&&"block"!==b)if("boolean"==typeof b)f=b?"block":"none";else{if(void 0!==b&&null!==b)return void this.handleError({source:"_LayoutMixin",error:'Invalid type passed as "show" property of "togglePane" function : '+typeof b});f="none"===g?"block":"none"}else f=b;b="block"===f,f!==g&&(i.set(e,"display",f),this.panes[a]._splitterWidget&&i.set(this.panes[a]._splitterWidget.domNode,"display",f),this.positionSideBarToggle(a),this.panes.outer&&this.panes.outer.resize(),d||c.publish("viewer/onTogglePane",{pane:a,show:b}))}}},positionSideBarToggle:function(a){var b=this.panes[a],c=this.collapseButtons[a];if(b&&c){var d=i.get(b.domNode,"display"),e="none"===d?"close":"open",f="none"===d?"open":"close";if(j.remove(c.children[0],e),j.add(c.children[0],f),"outer"===this.collapseButtonsPane){var g=b._splitterWidget?0:-1,h="bottom"===a||"top"===a?"h":"w";"block"===d&&(g+=k.getMarginBox(b.domNode)[h]),b._splitterWidget&&(g+=k.getMarginBox(b._splitterWidget.domNode)[h]),i.set(c,a,g.toString()+"px"),i.set(c,"display","block")}}},repositionSideBarButtons:function(){var a=["left","right","top","bottom"];d.forEach(a,b.hitch(this,function(a){this.positionSideBarToggle(a)}))},resizeLayout:function(){this.panes.outer.resize()},_splitterStartDrag:function(a){var b=this.collapseButtons[a];i.set(b,"display","none")},_splitterStopDrag:function(a){this.positionSideBarToggle(a)},detectTouchDevices:function(){l("touch")&&(l("ios")||l("android")||l("bb"))&&(l.add("mobile",!0),screen.availWidth<500||screen.availHeight<500?l.add("phone",!0):l.add("tablet",!0),l("phone")&&!this.config.mapOptions.infoWindow&&(this.config.mapOptions.infoWindow=new p(null,m("div"))))}})});
//# sourceMappingURL=_LayoutMixin.js.map