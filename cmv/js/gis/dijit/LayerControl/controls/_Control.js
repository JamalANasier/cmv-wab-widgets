/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.1
 *  Project: http://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/topic","dojo/dom-construct","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dojo/fx","dojo/html","./../plugins/LayerMenu","dojo/text!./templates/Control.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=a([],{templateString:m,controller:null,layer:null,layerTitle:"Layer Title",controlOptions:null,layerMenu:null,icons:null,_reorderUp:null,_reorderDown:null,_scaleRangeHandler:null,_expandClickHandler:null,constructor:function(a){a.controller&&(this.icons=a.controller.icons),this._handlers=[]},postCreate:function(){return this.inherited(arguments),this.controller?this.layer?void(this.layer.loaded?this._initialize():this._handlers.push(this.layer.on("load",b.hitch(this,"_initialize")))):(e.publish("viewer/handleError",{source:"LayerControl/_Control",error:"layer option is required"}),void this.destroy()):(e.publish("viewer/handleError",{source:"LayerControl/_Control",error:"controller option is required"}),void this.destroy())},_initialize:function(){this._layerTypePreInit&&this._layerTypePreInit();var a=this.layer,c=this.controlOptions;this._setLayerCheckbox(a,this.checkNode),k.set(this.labelNode,this.layerTitle),c.noMenu!==!0&&this.controller.noMenu!==!0||this.controller.noMenu===!0&&c.noMenu===!1?(this.layerMenu=new l({control:this,contextMenuForWindow:!1,targetNodeIds:[this.menuNode],leftClickToOpen:!0}),this.layerMenu.startup()):(h.remove(this.menuNode,"fa, layerControlMenuIcon, "+this.icons.menu),g.set(this.menuClickNode,"cursor","default")),0===a.minScale&&0===a.maxScale||(this._checkboxScaleRange(),this._scaleRangeHandler=a.getMap().on("zoom-end",b.hitch(this,"_checkboxScaleRange"))),this._layerTypeInit(),c.expanded&&c.sublayers&&this.expandClickNode.click(),this._handlers.push(d(this.checkNode,"click",b.hitch(this,"_setLayerVisibility",a,this.checkNode)),a.on("scale-range-change",b.hitch(this,"_scaleRangeChange")),a.on("update-start",b.hitch(this,"_updateStart")),a.on("update-end",b.hitch(this,"_updateEnd")),a.on("visibility-change",b.hitch(this,"_visibilityChange")))},_expandClick:function(){this._expandClickHandler=d(this.expandClickNode,"click",b.hitch(this,"_expandClicked")),this._handlers.push(this._expandClickHandler)},_expandClicked:function(){var a=this.icons,b=this.expandNode,c=this.expandIconNode;"none"===g.get(b,"display")?(j.wipeIn({node:b,duration:300}).play(),h.replace(c,a.collapse,a.expand)):(j.wipeOut({node:b,duration:300}).play(),h.replace(c,a.expand,a.collapse))},_expandRemove:function(){h.remove(this.expandIconNode,["fa",this.icons.expand,"layerControlToggleIcon"]),g.set(this.expandClickNode,"cursor","default"),f.destroy(this.expandNode)},_setLayerVisibility:function(a,b){a.visible?(this._setLayerCheckbox(a,b),a.hide(),e.publish("layerControl/layerToggle",{id:a.id,visible:a.visible})):(this._setLayerCheckbox(a,b),a.show(),e.publish("layerControl/layerToggle",{id:a.id,visible:a.visible})),0===a.minScale&&0===a.maxScale||this._checkboxScaleRange()},_setLayerCheckbox:function(a,b){var c=this.icons;a.visible?(i.set(b,"data-checked","checked"),h.replace(b,c.checked,c.unchecked)):(i.set(b,"data-checked","unchecked"),h.replace(b,c.unchecked,c.checked))},_checkboxScaleRange:function(){var a=this.checkNode,b=this.layer,c=b.getMap().getScale(),d=b.minScale,e=b.maxScale;h.remove(a,"layerControlCheckIconOutScale"),(0!==d&&c>d||0!==e&&c<e)&&h.add(a,"layerControlCheckIconOutScale")},_scaleRangeChange:function(){if(0!==this.layer.minScale||0!==this.layer.maxScale){if(this._checkboxScaleRange(),this._scaleRangeHandler){var a=c.indexOf(this._handlers,this._scaleRangeHandler);a!==-1&&(this._handlers[a].remove(),this._handlers.splice(a,1))}this._scaleRangeHandler=this.layer.getMap().on("zoom-end",b.hitch(this,"_checkboxScaleRange")),this._handlers.push(this._scaleRangeHandler)}else if(this._checkboxScaleRange(),this._scaleRangeHandler){var d=c.indexOf(this._handlers,this._scaleRangeHandler);d!==-1&&(this._handlers[d].remove(),this._handlers.splice(d,1)),this._scaleRangeHandler=null}},_updateStart:function(){g.set(this.layerUpdateNode,"display","inline-block"),this._layerState=b.clone({visible:this.layer.visible,visibleLayers:this.layer.visibleLayers||null})},_updateEnd:function(){if(g.set(this.layerUpdateNode,"display","none"),!this._layerState)return void(this._layerState=null)},_visibilityChange:function(a){(a.visible&&"unchecked"===i.get(this.checkNode,"data-checked")||!a.visible&&"checked"===i.get(this.checkNode,"data-checked"))&&this._setLayerCheckbox(this.layer,this.checkNode)},destroy:function(){this.inherited(arguments),this._handlers.forEach(function(a){a.remove()})}});return n});
//# sourceMappingURL=_Control.js.map