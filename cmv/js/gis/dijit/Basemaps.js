/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.1
 *  Project: http://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/_base/lang","dojo/_base/array","dojo/topic","dijit/DropDownMenu","dijit/MenuItem","esri/basemaps","esri/dijit/BasemapGallery","dojo/text!./Basemaps/templates/Basemaps.html","dojo/i18n!./Basemaps/nls/resource","dijit/form/DropDownButton","xstyle/css!./Basemaps/css/Basemaps.css"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){return a([b,c,d],{templateString:l,widgetsInTemplate:!0,i18n:m,title:m.title,basemaps:{},currentBasemap:null,mapStartBasemap:null,basemapsToShow:null,galleryOptions:{basemapIds:null,basemaps:null,basemapsGroup:null,bingMapsKey:null,portalUrl:null,referenceIds:null,showArcGISBasemaps:!1},postCreate:function(){this.inherited(arguments),this.initializeBasemaps(),this.createBasemapGallery(),g.subscribe("basemaps/updateBasemap",e.hitch(this,"updateBasemap"))},initializeBasemaps:function(){if(this.galleryOptions.basemaps)this.basemapsToShow=this.basemapsToShow||f.map(this.galleryOptions.basemaps,function(a){return a.id});else{(!this.basemaps||Object.keys(this.basemaps).length<1)&&(this.basemaps=e.clone(j),this.galleryOptions.showArcGISBasemaps=!1),this.basemapsToShow=this.basemapsToShow||Object.keys(this.basemaps);var a=[];f.forEach(this.basemapsToShow,e.hitch(this,function(b){var c=this.basemaps[b];if(c.basemap&&"esri.dijit.Basemap"===c.basemap.declaredClass){var d=c.basemap;d.title=c.title||d.title,d.id=b,a.push(d)}else j[b]||(c.basemap.title=c.title||c.basemap.title,j[b]=c.basemap),c.title=c.title||j[b].title,this.galleryOptions.showArcGISBasemaps=!1})),this.galleryOptions.basemaps=a}this.mapStartBasemap=this.mapStartBasemap||this.map.getBasemap(),f.indexOf(this.basemapsToShow,this.mapStartBasemap)<0&&(this.mapStartBasemap=this.basemapsToShow[0])},createBasemapGallery:function(){var a=e.mixin({map:this.map},this.galleryOptions);this.gallery=new k(a),this.gallery.startup(),this.galleryOptions.showArcGISBasemaps?this.gallery.on("load",e.hitch(this,"buildMenu")):this.buildMenu()},buildMenu:function(){this.menu=new h({style:"display: none;"}),f.forEach(this.basemapsToShow,function(a){if(this.basemaps.hasOwnProperty(a)){var b=new i({id:a,label:this.basemaps[a].title,iconClass:a===this.mapStartBasemap?"selectedIcon":"emptyIcon",onClick:e.hitch(this,"updateBasemap",a)});this.menu.addChild(b)}},this),this.dropDownButton.set("dropDown",this.menu),this.setStartingBasemap()},setStartingBasemap:function(){this.mapStartBasemap&&(this.gallery.get(this.mapStartBasemap)||j[this.mapStartBasemap])&&this.updateBasemap(this.mapStartBasemap)},updateBasemap:function(a){if(a!==this.currentBasemap&&f.indexOf(this.basemapsToShow,a)!==-1){if(this.gallery.get(a))this.gallery.select(a);else{if(!j[a])return void g.publish("viewer/error","Invalid basemap selected.");this.gallery._removeBasemapLayers(),this.gallery._removeReferenceLayer(),this.map.setBasemap(a)}this.currentBasemap=a;var b=this.menu.getChildren();f.forEach(b,function(b){b.id===a?b.set("iconClass","selectedIcon"):b.set("iconClass","emptyIcon")})}}})});
//# sourceMappingURL=Basemaps.js.map